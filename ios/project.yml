name: FlappyRust
options:
  bundleIdPrefix: com.matthieud134
targets:
  FlappyRust:
    type: application
    platform: iOS
    deploymentTarget: "16.0"
    info:
      path: Info.plist
      properties:
        UISupportedInterfaceOrientations: [UIInterfaceOrientationPortrait, UIInterfaceOrientationLandscapeLeft, UIInterfaceOrientationLandscapeRight]
        UILaunchScreen: {}
    sources:
      - path: ../assets
        name: assets
        type: folder
      - path: Assets.xcassets
      - path: dummy.c
        name: dummy.c
    settings:
      ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
      PRODUCT_BUNDLE_IDENTIFIER: com.matthieud134.flappy-rust
      ENABLE_BITCODE: NO
      "LIBRARY_SEARCH_PATHS[sdk=iphoneos*]":
        - $(inherited)
        - "${PROJECT_DIR}/../target/aarch64-apple-ios/debug"
      "LIBRARY_SEARCH_PATHS[sdk=iphonesimulator*]":
        - $(inherited)
        - "${PROJECT_DIR}/../target/aarch64-apple-ios-sim/debug"
      OTHER_LDFLAGS:
        - $(inherited)
        - -lflappy_rust
        - -framework AVFoundation
        - -framework AudioToolbox
        - -framework CoreFoundation
        - -framework CoreGraphics
        - -framework CoreMedia
        - -framework CoreVideo
        - -framework Foundation
        - -framework QuartzCore
        - -framework UIKit
        - -framework Metal
        - -framework GameController
        - -lobjc
    preBuildScripts:
      - name: Build Rust Library
        basedOnDependencyAnalysis: false
        script: |
          set -e  # Fail on error
          echo "ðŸš€ Starting Rust Build Phase..."

          # Add Cargo to PATH
          export PATH="$HOME/.cargo/bin:$PATH"

          # Go to project root
          cd ..

          echo "ðŸ“‚ Working directory: $(pwd)"
          echo "ðŸ“± Platform: $PLATFORM_NAME"

          if [ "$PLATFORM_NAME" = "iphonesimulator" ]; then
              echo "ðŸ›  Building for iOS Simulator..."
              cargo build --target aarch64-apple-ios-sim --verbose
          else
              echo "ðŸ›  Building for iOS Device..."
              cargo build --target aarch64-apple-ios --verbose
          fi

          echo "âœ… Rust Build Complete!"
